# Task 151: 메이크샵 치환코드 + 옵션 제한 검증

> **상태**: 1차 조사 완료 (실배포 테스트 대기)
> **Phase**: 1.5 (API 검증)
> **에이전트**: `주도` makeshop-planning-expert | `협업` qa-test-expert

---

## 목적

메이크샵 D4 치환코드 `{$member_id}`로 프론트엔드에서 로그인 회원 ID를 읽을 수 있는지 검증.
상품 옵션 수 제한도 확인. Phase 2 파트너 인증 메커니즘의 핵심 전제조건.

---

## 검증 항목 및 결과

### 치환코드 검증

- [x] 1단계: 기존 코드/문서 분석으로 치환코드 동작 방식 확인
- [x] 2단계: Playwright로 비로그인 상태 확인 (빈 문자열 치환 확인)
- [x] 3단계: 테스트 HTML/JS 파일 작성
- [ ] 4단계: 메이크샵 D4 개별 페이지에 배포 (사용자 작업)
- [ ] 5단계: 로그인/비로그인 상태에서 테스트 결과 확인

### 옵션 제한 검증

- [x] 1단계: 메이크샵 공식 문서/API 문서 조사 (제한 수치 미발견)
- [x] 2단계: 안전한 설계 기준 수립 (옵션 50개 이하)
- [ ] 3단계: 관리자에서 테스트 상품 옵션 등록 테스트 (사용자 작업)

### Phase 2 아키텍처 의사결정

- [x] 파트너 인증 메커니즘 설계 확정 (치환코드 3단계 인증)
- [x] 비로그인 UX 설계 확정
- [x] 클래스 상품 옵션 설계 권장안 작성

---

## 산출물

| 파일 | 설명 |
|------|------|
| `API검증/substitution-test.html` | 치환코드 테스트 HTML (배포용) |
| `API검증/substitution-test.js` | 치환코드 읽기 + GAS 전달 테스트 JS |
| `docs/api-verification/substitution-options-result.md` | 검증 결과 + Phase 2 아키텍처 의사결정 |

---

## 핵심 결론

### 1. 치환코드 (확인됨)

- `{$member_id}`: 로그인 시 실제 회원 ID, 비로그인 시 빈 문자열
- `<!--/if_login/-->`: 기존 간편구매에서 이미 동작 중 (실증적 증거)
- JS에서 DOM으로 읽기 -> GAS fetch 파라미터 전달 가능 (패턴 확립)

### 2. 옵션 제한 (미확인)

- 공식 문서에 명시된 제한 없음
- 안전 기준: 클래스당 월간 8~12개 옵션, 총 50개 이하 권장
- 실제 제한은 관리자에서 직접 테스트 필요

### 3. Phase 2 의사결정 (확정)

- 파트너 인증: 치환코드 기반 3단계 인증 확정
- 보안: Referer 체크 + member_id 매칭 + 파트너 Sheets 검증
- 비로그인 UX: 클래스 목록/상세는 누구나, 결제/대시보드는 로그인 필수

---

## 변경 이력

| 날짜 | 내용 |
|------|------|
| 2026-02-20 | 1차 조사 완료, 테스트 파일 작성, 의사결정 문서 초안 |
