# 네이버 지도 API 보안 설정 가이드

## 현재 상황
파트너맵 프로젝트에서 네이버 지도 API 키(`bfp8odep5r`)가 소스 코드에 직접 노출되어 있습니다.

## 문제점
- API 키가 브라우저 소스 코드에서 누구나 볼 수 있음
- 다른 사이트에서 이 키를 무단으로 사용할 위험이 있음
- 네이버 클라우드 플랫폼 API 사용량이 예상치 못하게 증가할 수 있음

## 해결 방법: 허용 도메인 설정

### 1단계: 네이버 클라우드 플랫폼 콘솔 접속

1. https://console.ncloud.com/ 접속
2. 로그인

### 2단계: Application 설정

1. 좌측 메뉴에서 **Services > Application** 선택
2. Maps API를 사용 중인 애플리케이션 선택

### 3단계: 허용 도메인(Referer) 설정

1. "Application 정보" 섹션에서 **허용 도메인** 또는 **Web 서비스 URL** 항목 찾기
2. 다음과 같이 설정:

```
https://your-makeshop-domain.com
https://www.your-makeshop-domain.com
http://localhost:*  (로컬 개발용 - 운영 시 제거 권장)
```

**예시 (프레스코21 실제 도메인):**
```
https://foreverlove.co.kr
https://www.foreverlove.co.kr
```

3. **저장** 버튼 클릭

### 4단계: 적용 확인

1. 설정 저장 후 5~10분 정도 기다림 (API 서버 반영 시간)
2. 실제 상점 도메인에서 파트너맵 페이지 접속
3. 지도가 정상적으로 로드되는지 확인
4. 브라우저 개발자 도구(F12) > Console 탭에서 에러 없는지 확인

### 5단계: 차단 확인 (선택사항)

허용하지 않은 도메인에서 API 키를 사용하려 하면 다음 에러 발생:
```
Blocked by Referer policy
```

이 에러가 발생하면 설정이 정상적으로 작동하는 것입니다.

## Google Apps Script URL 보안

파트너맵에서 사용 중인 Google Apps Script URL도 마찬가지로 접근 제한 설정을 권장합니다:

1. Google Apps Script 편집기 접속
2. 상단 메뉴 > **배포 > 배포 관리**
3. 현재 배포 선택 > **수정**
4. "액세스 권한" 항목에서:
   - "누구나" 대신 "특정 사용자" 또는 "도메인 내 사용자"로 변경
   - 또는 스크립트 내부에서 Referer 체크 로직 추가

## 추가 보안 권장 사항

### 1. API 사용량 모니터링
- 네이버 클라우드 플랫폼 콘솔에서 주기적으로 API 호출량 확인
- 비정상적인 사용량 급증 시 알림 설정

### 2. 예산 알림 설정
- 청구 섹션에서 예산 알림 설정
- 무료 한도 초과 시 자동 알림 받기

### 3. API 키 정기 갱신
- 보안 강화를 위해 6개월~1년마다 API 키 재발급 권장

## 문제 해결

### Q: 허용 도메인 설정 후 지도가 안 나옵니다
**A:** 다음을 확인하세요:
1. 설정한 도메인이 실제 접속 도메인과 정확히 일치하는지
2. `https://`와 `http://` 프로토콜이 맞는지
3. `www` 유무가 맞는지
4. 설정 후 5~10분 기다렸는지

### Q: localhost에서 개발할 수 없나요?
**A:** 허용 도메인에 `http://localhost:*` 또는 `http://127.0.0.1:*`을 추가하면 됩니다.
단, 운영 환경에서는 보안을 위해 제거하는 것이 좋습니다.

### Q: 여러 도메인에서 사용하고 싶습니다
**A:** 허용 도메인에 여러 줄로 추가하면 됩니다:
```
https://shop1.com
https://shop2.com
https://staging.shop1.com
```

---

**작성일:** 2026-02-15
**관련 파일:**
- `/파트너맵/js.js`
- `/파트너맵/Index.html`
